# georchestra-docker

This project allow to setup a Georchestra instance via Docker's containers.

The Postgis database and LDAP directory are persistent, and the http proxy is nginx.

Learn more about docker : https://www.docker.com/, https://docs.docker.com/

## Install Docker

In order to install Docker, I used the last Ubuntu distribution (Trusty 14.04).

First install wget if not already done :
```
sudo apt-get update && sudo apt-get install wget
```

Get the latest Docker package : 
```
wget -qO- https://get.docker.com/ | sh
```

Verify docker is installed correctly : 
```
sudo docker run hello-world
```

But you can install it on a lot of others distribution, cf. https://docs.docker.com/installation/
If you have some problems Google is your friend ;)

Personally, I had to configure DNS for docker in order to have my containers connected to internet :

Open the /etc/default/docker file for editing and add a setting for Docker DNS :
```
DOCKER_OPTS="--dns 8.8.8.8 --dns <other DNS entries>"
```

And finally restart docker : 
```
sudo restart docker
```

## Install Docker-Compose

To install Compose, run the following commands :
```
curl -L https://github.com/docker/compose/releases/download/1.2.0/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
```

Note: If you get a "Permission denied" error, your /usr/local/bin directory probably isn't writable and you'll need to install Compose as the superuser. Run sudo -i, then the two commands above, then exit.

## Configure Georchestra Docker

You can configure a lot of parameters in the configuration.txt file.

## Use georchestra-docker to generate images, template, ...

The georchestra-docker file is a binary that allow you to do severals usefull manipulations : 

- Generate a "template" dir to merge with your georchestra's template dir to get the corresponding configuration.

```
./georchestra-docker template
```

- Import WARS generated by a Georchestra compilation : 

First you have to launch a full compilation for georchestra, for example in georchestra directory :
```
./mvn -Dserver=docker-config -DskipTests -Pgeofence -Pgdal,kml,pyramid,jp2k,ogr,wps,inspire,libjpeg-turbo,app-schema,charts,control-flow '-Dgeoserver.war.excludes=WEB-INF/lib/*gwc*.jar,WEB-INF/lib/jai_*.jar' clean install
```

And after compilation end, use the command to import WARS in Docker application's configuration directory :
```
./georchestra-docker import-wars
```

For other commands, you can use the same as docker-compose ones (https://docs.docker.com/compose/#build-and-run-your-app-with-compose) :

```
./georchestra-docker rm|build|ps|up|stop
```

It's essential to use this bin to wrap with docker-compose because it will generate the docker-compose.yml file from the configuration.
